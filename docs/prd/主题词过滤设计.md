# ä¸»é¢˜è¯è¿‡æ»¤åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

åœ¨ RSS æ–‡çŒ®è¿½è¸ªç³»ç»Ÿä¸­å¢åŠ ä¸»é¢˜è¯è¿‡æ»¤æœºåˆ¶ï¼Œç³»ç»Ÿå®šæ—¶æ£€æµ‹åˆ° RSS æ–°æ–‡ç« åï¼Œå…ˆæ ¹æ®ç”¨æˆ·å…³æ³¨çš„ä¸»é¢˜é¢†åŸŸï¼ˆä¸»é¢˜è¯ï¼‰è°ƒç”¨å¤§æ¨¡å‹è¿›è¡Œè¿‡æ»¤ï¼Œåªæœ‰é€šè¿‡çš„æ–‡ç« æ‰è¿›å…¥åç»­çš„æ€»ç»“ã€QMD å…³è”ç­‰æµç¨‹ã€‚

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

1. **ä¸»é¢˜è¯ç®¡ç†**ï¼šç”¨æˆ·å¯ä»¥æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤å…³æ³¨çš„ä¸»é¢˜é¢†åŸŸå’Œä¸»é¢˜è¯
2. **å¤§æ¨¡å‹è¿‡æ»¤**ï¼šä½¿ç”¨ LLM åˆ¤æ–­æ–‡ç« æ˜¯å¦ä¸ä¸»é¢˜è¯ç›¸å…³
3. **ç®¡ç†é¡µé¢**ï¼šæä¾› Web ç•Œé¢ç®¡ç†ä¸»é¢˜è¯
4. **è¿‡æ»¤æµç¨‹**ï¼šåœ¨ RSS æŠ“å–åã€å¤„ç†å‰è¿›è¡Œè¿‡æ»¤

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. ä¸»é¢˜é¢†åŸŸè¡¨ (topic_domains)

```sql
CREATE TABLE topic_domains (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL REFERENCES users(id),
  name VARCHAR(255) NOT NULL,           -- ä¸»é¢˜é¢†åŸŸåç§°ï¼Œå¦‚"äººå·¥æ™ºèƒ½"ã€"æœºå™¨å­¦ä¹ "
  description TEXT,                     -- ä¸»é¢˜é¢†åŸŸæè¿°
  is_active BOOLEAN DEFAULT 1,          -- æ˜¯å¦å¯ç”¨
  priority INTEGER DEFAULT 0,           -- ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id, name)
);

CREATE INDEX idx_topic_domains_user ON topic_domains(user_id);
CREATE INDEX idx_topic_domains_active ON topic_domains(is_active);
```

### 2. ä¸»é¢˜è¯è¡¨ (topic_keywords)

```sql
CREATE TABLE topic_keywords (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  domain_id INTEGER NOT NULL REFERENCES topic_domains(id) ON DELETE CASCADE,
  keyword VARCHAR(255) NOT NULL,        -- ä¸»é¢˜è¯ï¼Œå¦‚"æ·±åº¦å­¦ä¹ "ã€"ç¥ç»ç½‘ç»œ"
  description TEXT,                     -- ä¸»é¢˜è¯æè¿°
  weight DECIMAL(3,2) DEFAULT 1.0,     -- æƒé‡ï¼Œ0.0-1.0ï¼Œç”¨äºè®¡ç®—ç›¸å…³æ€§
  is_active BOOLEAN DEFAULT 1,          -- æ˜¯å¦å¯ç”¨
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(domain_id, keyword)
);

CREATE INDEX idx_topic_keywords_domain ON topic_keywords(domain_id);
CREATE INDEX idx_topic_keywords_active ON topic_keywords(is_active);
```

### 3. æ–‡ç« è¿‡æ»¤è®°å½•è¡¨ (article_filter_logs)

```sql
CREATE TABLE article_filter_logs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  article_id INTEGER NOT NULL REFERENCES articles(id) ON DELETE CASCADE,
  domain_id INTEGER REFERENCES topic_domains(id),
  is_passed BOOLEAN NOT NULL,          -- æ˜¯å¦é€šè¿‡è¿‡æ»¤
  relevance_score DECIMAL(5,4),         -- ç›¸å…³æ€§è¯„åˆ† 0.0-1.0
  matched_keywords TEXT,                -- åŒ¹é…çš„ä¸»é¢˜è¯ï¼ˆJSON æ•°ç»„ï¼‰
  filter_reason TEXT,                   -- è¿‡æ»¤åŸå› 
  llm_response TEXT,                    -- LLM åŸå§‹å“åº”
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_article_filter_logs_article ON article_filter_logs(article_id);
CREATE INDEX idx_article_filter_logs_passed ON article_filter_logs(is_passed);
CREATE INDEX idx_article_filter_logs_domain ON article_filter_logs(domain_id);
```

### 4. ä¿®æ”¹ articles è¡¨

```sql
-- æ·»åŠ è¿‡æ»¤çŠ¶æ€å­—æ®µ
ALTER TABLE articles ADD COLUMN filter_status VARCHAR(20) DEFAULT 'pending';
-- filter_status: pending(å¾…è¿‡æ»¤), passed(é€šè¿‡), rejected(æ‹’ç»), skipped(è·³è¿‡)

ALTER TABLE articles ADD COLUMN filtered_at TIMESTAMP;
ALTER TABLE articles ADD COLUMN filter_score DECIMAL(5,4);  -- æœ€é«˜ç›¸å…³æ€§è¯„åˆ†
```

## ğŸ¤– å¤§æ¨¡å‹è¿‡æ»¤é€»è¾‘

### è¿‡æ»¤æç¤ºè¯è®¾è®¡

```typescript
const FILTER_PROMPT = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡çŒ®å†…å®¹åˆ†æåŠ©æ‰‹ã€‚è¯·åˆ¤æ–­ä»¥ä¸‹æ–‡ç« æ˜¯å¦ä¸ç”¨æˆ·å…³æ³¨çš„ä¸»é¢˜ç›¸å…³ã€‚

## ç”¨æˆ·å…³æ³¨çš„ä¸»é¢˜é¢†åŸŸå’Œä¸»é¢˜è¯ï¼š

${topicDomains.map(domain => `
### ${domain.name}
${domain.keywords.map(kw => `- ${kw.keyword} (æƒé‡: ${kw.weight})`).join('\n')}
`).join('\n')}

## å¾…åˆ†ææ–‡ç« ä¿¡æ¯ï¼š

æ ‡é¢˜ï¼š${article.title}
é“¾æ¥ï¼š${article.url}
æ‘˜è¦ï¼š${article.summary || 'æ— '}
å†…å®¹ç‰‡æ®µï¼š${article.contentSnippet || 'æ— '}

## åˆ†æè¦æ±‚ï¼š

1. è¯„ä¼°æ–‡ç« ä¸ä¸Šè¿°ä¸»é¢˜è¯çš„ç›¸å…³æ€§ï¼ˆ0.0-1.0ï¼‰
2. åˆ—å‡ºåŒ¹é…çš„ä¸»é¢˜è¯ï¼ˆè‡³å°‘ä¸€ä¸ªæ‰é€šè¿‡ï¼‰
3. æä¾›ç®€çŸ­çš„åˆ¤æ–­ç†ç”±

## è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰ï¼š

{
  "is_relevant": true/false,
  "relevance_score": 0.85,
  "matched_keywords": ["æ·±åº¦å­¦ä¹ ", "ç¥ç»ç½‘ç»œ"],
  "reason": "æ–‡ç« è¯¦ç»†ä»‹ç»äº†æ·±åº¦å­¦ä¹ åœ¨å›¾åƒè¯†åˆ«ä¸­çš„åº”ç”¨ï¼Œä¸ä¸»é¢˜é«˜åº¦ç›¸å…³"
}

è¯·ä¸¥æ ¼æŒ‰ç…§ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦åŒ…å«å…¶ä»–å†…å®¹ã€‚`;
```

### è¿‡æ»¤æµç¨‹

```mermaid
graph TB
    A[RSS æ–°æ–‡ç« ] --> B[è·å–ç”¨æˆ·å¯ç”¨çš„ä¸»é¢˜è¯]
    B --> C{æ˜¯å¦æœ‰å¯ç”¨ä¸»é¢˜è¯?}
    C -->|å¦| D[æ ‡è®°ä¸º skipped]
    C -->|æ˜¯| E[è°ƒç”¨ LLM è¿‡æ»¤]
    E --> F{is_relevant?}
    F -->|æ˜¯| G[æ ‡è®°ä¸º passed]
    F -->|å¦| H[æ ‡è®°ä¸º rejected]
    G --> I[è¿›å…¥åç»­å¤„ç†æµç¨‹]
    H --> J[è®°å½•è¿‡æ»¤æ—¥å¿—]
    D --> J
    J --> K[ç»“æŸ]
```

### è¿‡æ»¤ç­–ç•¥

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| **æ— å¯ç”¨ä¸»é¢˜è¯** | æ‰€æœ‰æ–‡ç« é€šè¿‡ï¼ˆskippedï¼‰ |
| **relevance_score >= 0.6** | é€šè¿‡ï¼ˆpassedï¼‰ |
| **relevance_score < 0.6** | æ‹’ç»ï¼ˆrejectedï¼‰ |
| **LLM è°ƒç”¨å¤±è´¥** | é™çº§ä¸ºå…³é”®è¯åŒ¹é…ï¼ˆpassed å¦‚æœåŒ¹é…ï¼‰ |
| **åŒ¹é…å…³é”®è¯æ•° >= 1** | é€šè¿‡ï¼ˆpassedï¼‰ |
| **åŒ¹é…å…³é”®è¯æ•° = 0** | æ‹’ç»ï¼ˆrejectedï¼‰ |

## ğŸŒ API æ¥å£è®¾è®¡

### 1. ä¸»é¢˜é¢†åŸŸç®¡ç†

#### è·å–ä¸»é¢˜é¢†åŸŸåˆ—è¡¨
```
GET /api/topic-domains
Query: ?user_id=1&include_keywords=true
Response: {
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "äººå·¥æ™ºèƒ½",
      "description": "AI ç›¸å…³æŠ€æœ¯",
      "is_active": true,
      "priority": 10,
      "keywords": [
        {
          "id": 1,
          "keyword": "æ·±åº¦å­¦ä¹ ",
          "weight": 1.0
        }
      ]
    }
  ]
}
```

#### åˆ›å»ºä¸»é¢˜é¢†åŸŸ
```
POST /api/topic-domains
Body: {
  "name": "äººå·¥æ™ºèƒ½",
  "description": "AI ç›¸å…³æŠ€æœ¯",
  "priority": 10
}
Response: {
  "success": true,
  "data": { "id": 1, ... }
}
```

#### æ›´æ–°ä¸»é¢˜é¢†åŸŸ
```
PUT /api/topic-domains/:id
Body: {
  "name": "äººå·¥æ™ºèƒ½",
  "description": "AI ç›¸å…³æŠ€æœ¯",
  "is_active": true,
  "priority": 10
}
```

#### åˆ é™¤ä¸»é¢˜é¢†åŸŸ
```
DELETE /api/topic-domains/:id
Response: { "success": true }
```

### 2. ä¸»é¢˜è¯ç®¡ç†

#### è·å–ä¸»é¢˜è¯åˆ—è¡¨
```
GET /api/topic-domains/:domain_id/keywords
Response: {
  "success": true,
  "data": [
    {
      "id": 1,
      "keyword": "æ·±åº¦å­¦ä¹ ",
      "description": "ç¥ç»ç½‘ç»œç›¸å…³",
      "weight": 1.0,
      "is_active": true
    }
  ]
}
```

#### åˆ›å»ºä¸»é¢˜è¯
```
POST /api/topic-domains/:domain_id/keywords
Body: {
  "keyword": "æ·±åº¦å­¦ä¹ ",
  "description": "ç¥ç»ç½‘ç»œç›¸å…³",
  "weight": 1.0
}
```

#### æ›´æ–°ä¸»é¢˜è¯
```
PUT /api/topic-keywords/:id
Body: {
  "keyword": "æ·±åº¦å­¦ä¹ ",
  "weight": 0.8,
  "is_active": true
}
```

#### åˆ é™¤ä¸»é¢˜è¯
```
DELETE /api/topic-keywords/:id
```

### 3. è¿‡æ»¤æ—¥å¿—æŸ¥è¯¢

#### è·å–è¿‡æ»¤æ—¥å¿—
```
GET /api/article-filter-logs
Query: ?article_id=1&domain_id=1&is_passed=true&page=1&limit=20
Response: {
  "success": true,
  "data": [...],
  "pagination": { "total": 100, "page": 1, "limit": 20 }
}
```

#### è·å–æ–‡ç« è¿‡æ»¤ç»Ÿè®¡
```
GET /api/article-filter-stats
Query: ?start_date=2024-01-01&end_date=2024-01-31
Response: {
  "success": true,
  "data": {
    "total": 1000,
    "passed": 600,
    "rejected": 300,
    "skipped": 100,
    "pass_rate": 0.6
  }
}
```

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡

### 1. ä¸»é¢˜è¯ç®¡ç†é¡µé¢ (`/topic-domains`)

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»é¢˜è¯ç®¡ç†                                    [+ æ–°å»ºé¢†åŸŸ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“ äººå·¥æ™ºèƒ½ (10 ä¸ªä¸»é¢˜è¯)  [âœ“ å¯ç”¨]  [ç¼–è¾‘] [åˆ é™¤] â”‚ â”‚
â”‚  â”‚    æ·±åº¦å­¦ä¹ ã€ç¥ç»ç½‘ç»œã€æœºå™¨å­¦ä¹ ...                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“ è‡ªç„¶è¯­è¨€å¤„ç† (5 ä¸ªä¸»é¢˜è¯)  [âœ“ å¯ç”¨]  [ç¼–è¾‘] [åˆ é™¤] â”‚ â”‚
â”‚  â”‚    NLPã€æ–‡æœ¬åˆ†æã€è¯­è¨€æ¨¡å‹...                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ–°å»º/ç¼–è¾‘ä¸»é¢˜é¢†åŸŸæ¨¡æ€æ¡†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°å»ºä¸»é¢˜é¢†åŸŸ              [Ã—]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åç§°: [________________________]   â”‚
â”‚  æè¿°: [________________________]   â”‚
â”‚       [________________________]   â”‚
â”‚  ä¼˜å…ˆçº§: [10]                      â”‚
â”‚  [âœ“] å¯ç”¨                          â”‚
â”‚                                     â”‚
â”‚  [å–æ¶ˆ]              [ä¿å­˜]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ä¸»é¢˜è¯è¯¦æƒ…é¡µé¢ (`/topic-domains/:id`)

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† è¿”å›  äººå·¥æ™ºèƒ½                          [+ æ·»åŠ ä¸»é¢˜è¯] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æè¿°: AI ç›¸å…³æŠ€æœ¯                                      â”‚
â”‚  ä¼˜å…ˆçº§: 10  [âœ“ å¯ç”¨                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ä¸»é¢˜è¯åˆ—è¡¨:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ·±åº¦å­¦ä¹   æƒé‡: 1.0  [âœ“]  [ç¼–è¾‘] [åˆ é™¤]          â”‚ â”‚
â”‚  â”‚ ç¥ç»ç½‘ç»œ  æƒé‡: 0.9  [âœ“]  [ç¼–è¾‘] [åˆ é™¤]          â”‚ â”‚
â”‚  â”‚ æœºå™¨å­¦ä¹   æƒé‡: 0.8  [âœ—]  [ç¼–è¾‘] [åˆ é™¤]          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ·»åŠ /ç¼–è¾‘ä¸»é¢˜è¯æ¨¡æ€æ¡†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ·»åŠ ä¸»é¢˜è¯                [Ã—]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸»é¢˜è¯: [________________________]  â”‚
â”‚  æè¿°: [________________________]   â”‚
â”‚  æƒé‡: [1.0] (0.0 - 1.0)           â”‚
â”‚  [âœ“] å¯ç”¨                          â”‚
â”‚                                     â”‚
â”‚  [å–æ¶ˆ]              [ä¿å­˜]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. è¿‡æ»¤æ—¥å¿—é¡µé¢ (`/filter-logs`)

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿‡æ»¤æ—¥å¿—                                    [å¯¼å‡º CSV] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­›é€‰: [å…¨éƒ¨ â–¼]  [æ—¥æœŸèŒƒå›´: 2024-01-01 ~ 2024-01-31]   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 2024-01-15 10:30  âœ“ é€šè¿‡  0.85                   â”‚ â”‚
â”‚  â”‚ æ–‡ç« : æ·±åº¦å­¦ä¹ åœ¨å›¾åƒè¯†åˆ«ä¸­çš„åº”ç”¨                  â”‚ â”‚
â”‚  â”‚ åŒ¹é…: æ·±åº¦å­¦ä¹ ã€ç¥ç»ç½‘ç»œ                          â”‚ â”‚
â”‚  â”‚ åŸå› : æ–‡ç« è¯¦ç»†ä»‹ç»äº†æ·±åº¦å­¦ä¹ ...                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 2024-01-15 10:25  âœ— æ‹’ç»  0.30                   â”‚ â”‚
â”‚  â”‚ æ–‡ç« : å¦‚ä½•ç§æ¤æœ‰æœºè”¬èœ                            â”‚ â”‚
â”‚  â”‚ åŒ¹é…: æ—                                           â”‚ â”‚
â”‚  â”‚ åŸå› : æ–‡ç« å†…å®¹ä¸ä¸»é¢˜æ— å…³                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. è¿‡æ»¤ç»Ÿè®¡é¡µé¢ (`/filter-stats`)

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿‡æ»¤ç»Ÿè®¡                                    [åˆ·æ–°]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ—¶é—´èŒƒå›´: [2024-01-01] ~ [2024-01-31]  [æŸ¥è¯¢]         â”‚
â”‚                                                         â”‚
â”‚  æ€»ä½“ç»Ÿè®¡:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ€»æ–‡ç« æ•°: 1,000                                  â”‚ â”‚
â”‚  â”‚  é€šè¿‡: 600 (60%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚ â”‚
â”‚  â”‚  æ‹’ç»: 300 (30%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚ â”‚
â”‚  â”‚  è·³è¿‡: 100 (10%)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  æŒ‰ä¸»é¢˜é¢†åŸŸç»Ÿè®¡:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  äººå·¥æ™ºèƒ½: 500 ç¯‡, é€šè¿‡ç‡ 70%                     â”‚ â”‚
â”‚  â”‚  è‡ªç„¶è¯­è¨€å¤„ç†: 300 ç¯‡, é€šè¿‡ç‡ 50%                 â”‚ â”‚
â”‚  â”‚  è®¡ç®—æœºè§†è§‰: 200 ç¯‡, é€šè¿‡ç‡ 65%                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ å®ç°ç»†èŠ‚

### 1. è¿‡æ»¤æœåŠ¡æ¨¡å— (`src/filter.ts`)

```typescript
interface FilterOptions {
  minRelevanceScore?: number;  // æœ€å°ç›¸å…³æ€§è¯„åˆ†ï¼Œé»˜è®¤ 0.6
  requireKeywordMatch?: boolean;  // æ˜¯å¦è¦æ±‚è‡³å°‘åŒ¹é…ä¸€ä¸ªå…³é”®è¯
  fallbackToKeywordMatch?: boolean;  // LLM å¤±è´¥æ—¶æ˜¯å¦é™çº§åˆ°å…³é”®è¯åŒ¹é…
}

class ArticleFilter {
  async filterArticle(
    article: Article,
    topicDomains: TopicDomain[],
    options: FilterOptions = {}
  ): Promise<FilterResult> {
    // 1. æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„ä¸»é¢˜è¯
    const activeDomains = topicDomains.filter(d => d.is_active);
    if (activeDomains.length === 0) {
      return { is_passed: true, status: 'skipped', reason: 'æ— å¯ç”¨ä¸»é¢˜è¯' };
    }

    // 2. è°ƒç”¨ LLM è¿‡æ»¤
    try {
      const llmResult = await this.callLLM(article, activeDomains);
      
      // 3. åˆ¤æ–­æ˜¯å¦é€šè¿‡
      const minScore = options.minRelevanceScore ?? 0.6;
      const isPassed = llmResult.is_relevant && 
                       llmResult.relevance_score >= minScore &&
                       llmResult.matched_keywords.length > 0;

      // 4. è®°å½•è¿‡æ»¤æ—¥å¿—
      await this.logFilterResult(article, llmResult, isPassed);

      return {
        is_passed: isPassed,
        status: isPassed ? 'passed' : 'rejected',
        relevance_score: llmResult.relevance_score,
        matched_keywords: llmResult.matched_keywords,
        reason: llmResult.reason
      };
    } catch (error) {
      // 5. LLM å¤±è´¥ï¼Œé™çº§åˆ°å…³é”®è¯åŒ¹é…
      if (options.fallbackToKeywordMatch) {
        const keywordResult = await this.keywordMatch(article, activeDomains);
        return keywordResult;
      }
      
      // 6. å¤±è´¥å¤„ç†
      return {
        is_passed: false,
        status: 'rejected',
        reason: 'LLM è°ƒç”¨å¤±è´¥'
      };
    }
  }

  private async callLLM(
    article: Article,
    domains: TopicDomain[]
  ): Promise<LLMFilterResult> {
    const prompt = this.buildFilterPrompt(article, domains);
    const response = await llm.chat(prompt, { jsonMode: true });
    return JSON.parse(response);
  }

  private async keywordMatch(
    article: Article,
    domains: TopicDomain[]
  ): Promise<FilterResult> {
    const text = `${article.title} ${article.summary} ${article.contentSnippet}`.toLowerCase();
    const matchedKeywords: string[] = [];
    let maxScore = 0;

    for (const domain of domains) {
      for (const keyword of domain.keywords.filter(k => k.is_active)) {
        if (text.includes(keyword.keyword.toLowerCase())) {
          matchedKeywords.push(keyword.keyword);
          maxScore = Math.max(maxScore, keyword.weight);
        }
      }
    }

    const isPassed = matchedKeywords.length > 0;
    return {
      is_passed: isPassed,
      status: isPassed ? 'passed' : 'rejected',
      relevance_score: maxScore,
      matched_keywords: matchedKeywords,
      reason: isPassed ? 'å…³é”®è¯åŒ¹é…' : 'æ— åŒ¹é…å…³é”®è¯'
    };
  }
}
```

### 2. é›†æˆåˆ° RSS å¤„ç†æµç¨‹

```typescript
// åœ¨ pipeline.ts ä¸­é›†æˆ
async function processRSSArticle(article: RSSArticle) {
  // 1. ä¿å­˜æ–‡ç« åˆ°æ•°æ®åº“ï¼ˆçŠ¶æ€: pendingï¼‰
  const savedArticle = await db.insertInto('articles')
    .values({
      title: article.title,
      url: article.link,
      summary: article.description,
      content: article.content,
      filter_status: 'pending',
      created_at: new Date()
    })
    .returningAll()
    .executeTakeFirst();

  // 2. è·å–ç”¨æˆ·çš„ä¸»é¢˜è¯é…ç½®
  const topicDomains = await getActiveTopicDomains(userId);

  // 3. æ‰§è¡Œè¿‡æ»¤
  const filter = new ArticleFilter();
  const filterResult = await filter.filterArticle(savedArticle, topicDomains);

  // 4. æ›´æ–°æ–‡ç« è¿‡æ»¤çŠ¶æ€
  await db.updateTable('articles')
    .set({
      filter_status: filterResult.status,
      filter_score: filterResult.relevance_score,
      filtered_at: new Date()
    })
    .where('id', '=', savedArticle.id)
    .execute();

  // 5. å¦‚æœé€šè¿‡ï¼Œç»§ç»­åç»­å¤„ç†
  if (filterResult.is_passed) {
    await processArticleContent(savedArticle);
  }
}
```

### 3. Web API è·¯ç”±

```typescript
// åœ¨ web.ts ä¸­æ·»åŠ è·¯ç”±
app.get('/api/topic-domains', async (req, res) => {
  const userId = req.user.id;
  const includeKeywords = req.query.include_keywords === 'true';
  
  const domains = await db.selectFrom('topic_domains')
    .where('user_id', '=', userId)
    .selectAll()
    .execute();

  if (includeKeywords) {
    for (const domain of domains) {
      domain.keywords = await db.selectFrom('topic_keywords')
        .where('domain_id', '=', domain.id)
        .selectAll()
        .execute();
    }
  }

  res.json({ success: true, data: domains });
});

app.post('/api/topic-domains', async (req, res) => {
  const userId = req.user.id;
  const { name, description, priority } = req.body;

  const domain = await db.insertInto('topic_domains')
    .values({
      user_id: userId,
      name,
      description,
      priority: priority ?? 0
    })
    .returningAll()
    .executeTakeFirst();

  res.json({ success: true, data: domain });
});

// ... å…¶ä»–è·¯ç”±
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

1. **æ‰¹é‡è¿‡æ»¤**ï¼šä¸€æ¬¡ LLM è°ƒç”¨å¯ä»¥è¿‡æ»¤å¤šç¯‡æ–‡ç« 
2. **ç¼“å­˜æœºåˆ¶**ï¼šç¼“å­˜ LLM å“åº”ï¼Œé¿å…é‡å¤è°ƒç”¨
3. **å¼‚æ­¥å¤„ç†**ï¼šè¿‡æ»¤æ“ä½œå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ RSS æŠ“å–
4. **é™çº§ç­–ç•¥**ï¼šLLM å¤±è´¥æ—¶é™çº§åˆ°å…³é”®è¯åŒ¹é…
5. **ç´¢å¼•ä¼˜åŒ–**ï¼šä¸ºè¿‡æ»¤æ—¥å¿—è¡¨æ·»åŠ åˆé€‚çš„ç´¢å¼•

## ğŸ”„ æ›´æ–° PRD æ–‡æ¡£

éœ€è¦åœ¨ [`docs/prd/åˆå§‹è®¨è®º.md`](docs/prd/åˆå§‹è®¨è®º.md:1) ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

1. åœ¨"éœ€è¦æ–°å¢çš„åŠŸèƒ½"éƒ¨åˆ†æ·»åŠ ä¸»é¢˜è¯è¿‡æ»¤åŠŸèƒ½
2. åœ¨æ•°æ®åº“è®¾è®¡éƒ¨åˆ†æ·»åŠ ä¸»é¢˜è¯ç›¸å…³è¡¨
3. åœ¨å®ç°è·¯çº¿å›¾ä¸­æ·»åŠ ä¸»é¢˜è¯è¿‡æ»¤é˜¶æ®µ
4. æ›´æ–°æŠ€æœ¯æ ˆè¯´æ˜

## ğŸ“ æ€»ç»“

ä¸»é¢˜è¯è¿‡æ»¤åŠŸèƒ½é€šè¿‡ä»¥ä¸‹æ–¹å¼å¢å¼º RSS æ–‡çŒ®è¿½è¸ªç³»ç»Ÿï¼š

1. **æ™ºèƒ½è¿‡æ»¤**ï¼šä½¿ç”¨ LLM åˆ¤æ–­æ–‡ç« ç›¸å…³æ€§ï¼Œæé«˜è¿‡æ»¤å‡†ç¡®æ€§
2. **çµæ´»é…ç½®**ï¼šç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜é¢†åŸŸå’Œä¸»é¢˜è¯
3. **å¯è§†åŒ–ç®¡ç†**ï¼šæä¾›å®Œæ•´çš„ç®¡ç†ç•Œé¢å’Œç»Ÿè®¡åŠŸèƒ½
4. **é™çº§ä¿éšœ**ï¼šLLM å¤±è´¥æ—¶é™çº§åˆ°å…³é”®è¯åŒ¹é…ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
5. **å¯è¿½æº¯æ€§**ï¼šè®°å½•æ‰€æœ‰è¿‡æ»¤æ—¥å¿—ï¼Œä¾¿äºåˆ†æå’Œä¼˜åŒ–
